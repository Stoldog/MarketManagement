<div class="row">
    <div class="col-md-12">
        <div class="box box-info collapsed-box">
            <div class="box-header with-border">
                <div class="pull-left">
                    <button class="btn btn-success" onclick="searchUserList()"><i class=""></i>查询</button>
                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
                </div>
            </div>
            <div class="box-body">
                <div class="col-md-3">
                    <label>职务:</label>
                    <select class="form-control" id="departType">
                        <option value="-1">所有</option>
                    </select>
                </div>
            </div>
            <div class="box">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <th>
                            <button class="btn btn-link" title="用户名" data-toggle="tooltip" data-placement="top" style="color: #333333;font-weight: bold;font-family:微软雅黑;">
                                用户名
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link" title="职务" data-toggle="tooltip" data-placement="top" style="color: #333333;font-weight: bold;font-family:微软雅黑;">
                                职务
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link" title="性别" data-toggle="tooltip" data-placement="top" style="color: #333333;font-weight: bold;font-family:微软雅黑;">
                                性别
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link" title="手机号" data-toggle="tooltip" data-placement="top" style="color: #333333;font-weight: bold;font-family:微软雅黑;">
                                手机号
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link" title="邮箱" data-toggle="tooltip" data-placement="top" style="color: #333333;font-weight: bold;font-family:微软雅黑;">
                                邮箱
                            </button>
                        </th>
                        <th>
                            <button class="btn btn-link" title="操作" data-toggle="tooltip" data-placement="top" style="color: #333333;font-weight: bold;font-family:微软雅黑;">
                                操作
                            </button>
                        </th>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!--模态框-->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="myModalLabel">请填写用户信息</h4>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="newUid"/>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>用户名：</label>
                                <input class="form-control" id="newUsername" type="text"/>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>密码：</label>
                                <input class="form-control" id="newPassword" type="text"/>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>职务：</label>
                                <select id="newDepartType" class="form-control">

                                </select>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>性别：</label>
                                <input class="form-control" id="newSex" type="text"/>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>手机号：</label>
                                <input class="form-control" id="newTel" type="text"/>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>邮箱：</label>
                                <input class="form-control" id="newEmail" oninput="dyEmails(this)" type="text" list="emails"/>
                                <datalist id="emails">

                                </datalist>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="cancelBtn" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" id="confirmBtn" onclick="commitEdit()" class="btn btn-primary">提交更改</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>
        <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="myModalLabel2">是否确认删除此用户？</h4>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="delUid">
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="cancelBtn2" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" id="confirmBtn2" onclick="commitDel()" class="btn btn-danger">提交删除</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>
        <!--模态框结束-->
    </div>
</div>
<script>
    $(function () {
        //获得职务列表
        $.ajax("/user/getDepartList",{
            method:"GET",
            async:false,
            contentType:"application/json; charset=utf-8",
            success:function (res) {
                //console.log(res);
                //删除之前的节点
                $("#departType").find("option").remove();
                //遍历节点
                $("#departType").append("<option selected='selected' value='-1'>所有</option>");
                $(res.list).each(function () {
                    $("#departType").append("<option value='"+this.departValue+"'>"+this.departName+"</option>");
                    $("#newDepartType").append("<option value='"+this.departValue+"'>"+this.departName+"</option>");
                });
                //初次查询
                searchUserList();
            }
        });
    });
    //查询
    function searchUserList() {
        var departType=$("#departType").val();
        //发送请求
        $.ajax("/user/getUserByDepartType/"+departType,{
            method:"GET",
            contentType:"application/json ;charset=utf-8",
            success:function (res) {
                console.log(res);
                //删除之前的节点
                $("tbody").find("tr").remove();
                //遍历子节点
                $(res.list).each(function () {
                   $("tbody").append("<tr><td>"+this.username+"</td><td>"+this.department+"</td><td>"+this.sex+"</td><td>"+this.tel+"</td><td>"+this.email+"</td><td><div class='btn-group'><button class='btn btn-default' onclick='editUser("+JSON.stringify(this)+")'><i></i>修改</button><button class='btn btn-danger' onclick='delUser("+JSON.stringify(this)+")'><i></i>删除</button></div></td></tr>");
                });
            }
        });
    }
    //修改
    function editUser(userTemp) {
        console.log(userTemp);
        //var userTemp=JSON.parse(getUser);
        //回填
        $("#newUid").val(userTemp.uid);
        $("#newUsername").val(userTemp.username);
        $("#newPassword").val(userTemp.password);
        $("#newDepartType").val(userTemp.departType);
        $("#newSex").val(userTemp.sex);
        $("#newTel").val(userTemp.tel);
        $("#newEmail").val(userTemp.email);

        $("#myModal").modal();
    }
    //删除
    function delUser(getDel) {
        console.log(getDel);
        //回填id
        $("#delUid").val(getDel.uid);
        $("#myModal2").modal();
    }
    //动态邮箱
    function dyEmails(getDyEmails) {
        $("#emails").find("option").remove();
        $("#emails").append("<option value='"+$(getDyEmails).val()+"@gmail.com'><option value='"+$(getDyEmails).val()+"@163.com'><option value='"+$(getDyEmails).val()+"@qq.com'><option value='"+$(getDyEmails).val()+"@126.com'>")
    }
    //提交修改
    function commitEdit() {
        //获得发送的数据
        var sendData={
            "uid":$("#newUid").val(),
            "username":$("#newUsername").val(),
            "password":$("#newPassword").val(),
            "sex":$("#newSex").val(),
            "tel":$("#newTel").val(),
            "departType":$("#newDepartType").val(),
            "department":$("#newDepartType  option:selected").text(),
            "email":$("#newEmail").val()
        };
        //发送请求
        $.ajax("/user/editUser",{
            method:"POST",
            contentType:"application/json; charset=utf-8",
            data:JSON.stringify(sendData),
            success:function (res) {
                console.log(res);
            }
        });
    }
    //提交删除
    function commitDel() {
        var dUid=$("#delUid").val();
        console.log(dUid);
        //发送请求
        $.ajax("/user/delUser/"+dUid,{
            method:"GET",
            contentType:"application/json; charset=utf-8",
            success:function (res) {
                console.log(res);
            }
        });
    }
</script>